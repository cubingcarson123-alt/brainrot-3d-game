<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Maze Game</title>
<style>
html,body{margin:0;overflow:hidden;background:#000}
canvas{display:block}
#menu,#scare{
 position:fixed;inset:0;
 display:flex;align-items:center;justify-content:center;
 background:#000;color:#fff;font-family:sans-serif
}
#menu button{font-size:24px;padding:10px 30px}
#meter{
 position:fixed;bottom:20px;left:50%;
 transform:translateX(-50%);
 width:300px;height:10px;border:1px solid #fff
}
#fill{height:100%;width:0;background:red}
#scare{display:none;font-size:80px}
</style>
</head>
<body>

<div id="menu"><button>START</button></div>
<div id="scare">ðŸ‘¹</div>
<div id="meter"><div id="fill"></div></div>
<canvas id="c"></canvas>

<script>
const c=document.getElementById("c"),x=c.getContext("2d");
resize();addEventListener("resize",resize);
function resize(){c.width=innerWidth;c.height=innerHeight}

/* ===== MAP ===== */
const map=[
"############",
"#..........#",
"#..####....#",
"#..........#",
"#....####..#",
"#..........#",
"#..####....#",
"#..........#",
"############"
];

/* ===== PLAYER ===== */
let p={x:2.5,y:2.5,a:0};
let W=false,locked=false;

/* ===== ENEMY ===== */
let e={x:9.5,y:6.5,s:0.015};
let danger=0,dead=false;

/* ===== INPUT ===== */
onkeydown=e2=>{if(e2.key==="w")W=true}
onkeyup=e2=>{if(e2.key==="w")W=false}

c.onclick=()=>c.requestPointerLock();
document.onpointerlockchange=()=>locked=document.pointerLockElement===c;
document.onmousemove=e2=>{
 if(!locked)return;
 p.a-=e2.movementX*0.0006;
};

/* ===== UTILS ===== */
function wall(x,y){
 return map[Math.floor(y)]?.[Math.floor(x)]==="#";
}

/* ===== UPDATE ===== */
function update(){
 if(dead)return;

 if(W){
  let nx=p.x+Math.cos(p.a)*0.05;
  let ny=p.y+Math.sin(p.a)*0.05;
  if(!wall(nx,p.y))p.x=nx;
  if(!wall(p.x,ny))p.y=ny;
 }

 // enemy simple chase
 let dx=p.x-e.x,dy=p.y-e.y;
 let d=Math.hypot(dx,dy);
 e.x+=dx/d*e.s;
 e.y+=dy/d*e.s;

 danger=Math.min(100,danger+(1/d)*0.8);
 document.getElementById("fill").style.width=danger+"%";

 if(d<0.6){
  dead=true;
  document.exitPointerLock();
  document.getElementById("scare").style.display="flex";
 }
}

/* ===== RENDER ===== */
function render(){
 x.fillStyle="#000";
 x.fillRect(0,0,c.width,c.height);

 const fov=Math.PI/3;
 for(let i=0;i<c.width;i++){
  let ra=p.a-fov/2+i/c.width*fov;
  let dist=0;
  while(dist<20){
   dist+=0.02;
   let rx=p.x+Math.cos(ra)*dist;
   let ry=p.y+Math.sin(ra)*dist;
   if(wall(rx,ry))break;
  }
  let h=c.height/(dist*0.7);
  let shade=200-dist*20;
  x.fillStyle=`rgb(${shade},${shade},${shade})`;
  x.fillRect(i,(c.height-h)/2,1,h);
 }
}

/* ===== LOOP ===== */
function loop(){
 update();
 render();
 requestAnimationFrame(loop);
}

/* ===== MENU ===== */
document.querySelector("button").onclick=()=>{
 document.getElementById("menu").style.display="none";
 c.requestPointerLock();
 loop();
};
</script>
</body>
</html>
