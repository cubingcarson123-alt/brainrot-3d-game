<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>BIG MAZE â€“ TUNG TUNG TUNG SAHUR</title>
<style>
body{margin:0;overflow:hidden;background:#000}
#ui{
 position:fixed;top:10px;left:50%;transform:translateX(-50%);
 width:300px;height:12px;border:2px solid #fff
}
#bar{height:100%;width:100%;background:#0f0}
#map{
 position:fixed;right:10px;top:10px;
 width:160px;height:160px;
 background:#111;border:2px solid #fff
}
</style>
</head>
<body>
<div id="ui"><div id="bar"></div></div>
<canvas id="map"></canvas>

<script src="https://cdn.jsdelivr.net/npm/three@0.158/build/three.min.js"></script>
<script>
/* ===== SCENE ===== */
const scene=new THREE.Scene();
scene.background=new THREE.Color(0x202830);

const camera=new THREE.PerspectiveCamera(75,innerWidth/innerHeight,0.1,1000);
camera.position.set(1,1.6,1);

const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
document.body.appendChild(renderer.domElement);

/* ===== LIGHT ===== */
scene.add(new THREE.AmbientLight(0xffffff,0.7));
const sun=new THREE.DirectionalLight(0xffffff,0.8);
sun.position.set(10,20,10);
scene.add(sun);

/* ===== FLOOR ===== */
const floor=new THREE.Mesh(
 new THREE.PlaneGeometry(200,200),
 new THREE.MeshStandardMaterial({color:0x555555})
);
floor.rotation.x=-Math.PI/2;
scene.add(floor);

/* ===== MAZE ===== */
const walls=[];
const wallMat=new THREE.MeshStandardMaterial({color:0x4aa3ff});

function wall(x,z,w,d){
 const m=new THREE.Mesh(new THREE.BoxGeometry(w,2,d),wallMat);
 m.position.set(x,1,z);
 m.userData={w,d};
 scene.add(m);walls.push(m);
}

/* big maze */
for(let i=-90;i<=90;i+=10){ wall(i,-90,10,2); wall(i,90,10,2); }
for(let i=-80;i<=80;i+=20){
 wall(-90,i,2,20); wall(90,i,2,20);
 wall(i,0,2,40);
}
wall(30,30,40,2); wall(-30,-30,40,2);
wall(0,60,80,2); wall(0,-60,80,2);

/* ===== EXIT ===== */
const exit=new THREE.Mesh(
 new THREE.BoxGeometry(4,4,4),
 new THREE.MeshStandardMaterial({color:0x00ff00,emissive:0x00aa00})
);
exit.position.set(80,2,80);
scene.add(exit);

/* ===== COLLISION ===== */
function hit(pos,r=0.6){
 for(const w of walls){
  if(Math.abs(pos.x-w.position.x)<w.userData.w/2+r &&
     Math.abs(pos.z-w.position.z)<w.userData.d/2+r) return true;
 }
 return false;
}

/* ===== PLAYER ===== */
let yaw=0,moving=false,health=100;

/* ===== ENEMY (TUNG TUNG TUNG SAHUR FACE) ===== */
function faceTexture(){
 const c=document.createElement("canvas");
 c.width=c.height=256;
 const g=c.getContext("2d");
 g.fillStyle="#f2c9a0";g.fillRect(0,0,256,256);
 g.fillStyle="#000";
 g.beginPath();g.arc(80,100,20,0,Math.PI*2);g.arc(176,100,20,0,Math.PI*2);g.fill();
 g.fillRect(80,160,96,12);
 g.font="30px sans-serif";g.fillText("TUNG",60,40);
 return new THREE.CanvasTexture(c);
}
const enemy=new THREE.Mesh(
 new THREE.BoxGeometry(2,3,2),
 [
  new THREE.MeshStandardMaterial({map:faceTexture()}),
  new THREE.MeshStandardMaterial({color:0xff5555}),
  new THREE.MeshStandardMaterial({color:0xff5555}),
  new THREE.MeshStandardMaterial({color:0xff5555}),
  new THREE.MeshStandardMaterial({color:0xff5555}),
  new THREE.MeshStandardMaterial({color:0xff5555}),
 ]
);
enemy.position.set(-80,1.5,-80);
scene.add(enemy);

/* ===== CONTROLS ===== */
document.body.onclick=()=>document.body.requestPointerLock();
document.addEventListener("mousemove",e=>{
 if(document.pointerLockElement) yaw-=e.movementX*0.002;
});
document.addEventListener("keydown",e=>{if(e.key==="w")moving=true});
document.addEventListener("keyup",e=>{if(e.key==="w")moving=false});

/* ===== MAP ===== */
const map=document.getElementById("map");
const ctx=map.getContext("2d");

/* ===== LOOP ===== */
function animate(){
 requestAnimationFrame(animate);
 camera.rotation.y=yaw;

 if(moving){
  const d=new THREE.Vector3(-Math.sin(yaw),0,-Math.cos(yaw));
  const n=camera.position.clone().add(d.multiplyScalar(0.15));
  if(!hit(n)) camera.position.copy(n);
 }

 /* enemy chase */
 const v=camera.position.clone().sub(enemy.position);
 v.y=0;v.normalize();
 const en=enemy.position.clone().add(v.multiplyScalar(0.05));
 if(!hit(en)) enemy.position.copy(en);

 if(enemy.position.distanceTo(camera.position)<1.5){
  health=Math.max(0,health-0.3);
  document.getElementById("bar").style.width=health+"%";
 }

 if(camera.position.distanceTo(exit.position)<3){
  alert("YOU ESCAPED");
  location.reload();
 }

 /* minimap */
 ctx.clearRect(0,0,160,160);
 ctx.fillStyle="#444";ctx.fillRect(0,0,160,160);
 ctx.fillStyle="#0f0";
 ctx.fillRect(camera.position.x/2+80,camera.position.z/2+80,4,4);
 ctx.fillStyle="#f00";
 ctx.fillRect(enemy.position.x/2+80,enemy.position.z/2+80,4,4);

 renderer.render(scene,camera);
}
animate();

onresize=()=>{
 camera.aspect=innerWidth/innerHeight;
 camera.updateProjectionMatrix();
 renderer.setSize(innerWidth,innerHeight);
};
</script>
</body>
</html>
