<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Maze Fix</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    background: black;
  }
  canvas {
    display: block;
  }
  #hint {
    position: fixed;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    color: white;
    font-family: monospace;
    opacity: 0.8;
  }
</style>
</head>
<body>
<div id="hint">Click to lock mouse â€¢ Hold W to move</div>
<canvas id="c"></canvas>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");
canvas.width = innerWidth;
canvas.height = innerHeight;

window.onresize = () => {
  canvas.width = innerWidth;
  canvas.height = innerHeight;
};

// ===== PLAYER =====
const player = {
  x: 200,
  y: 200,
  angle: 0,
  speed: 2.5,
  radius: 12
};

let forward = false;

// ===== INPUT =====
document.addEventListener("click", () => {
  canvas.requestPointerLock();
});

document.addEventListener("mousemove", e => {
  if (document.pointerLockElement === canvas) {
    player.angle += e.movementX * 0.002;
  }
});

document.addEventListener("keydown", e => {
  if (e.code === "KeyW") forward = true;
});

document.addEventListener("keyup", e => {
  if (e.code === "KeyW") forward = false;
});

// ===== MAZE (BIG + WIDE) =====
const TILE = 80; // WIDE corridors
const maze = [
  "1111111111111",
  "1000000000001",
  "1011110111101",
  "1010000100001",
  "1010111111101",
  "1000100000001",
  "1111111111111"
];

// ===== COLLISION =====
function hitsWall(x, y) {
  const gx = Math.floor(x / TILE);
  const gy = Math.floor(y / TILE);
  return maze[gy]?.[gx] === "1";
}

// ===== UPDATE =====
function update() {
  if (forward) {
    const nx = player.x + Math.cos(player.angle) * player.speed;
    const ny = player.y + Math.sin(player.angle) * player.speed;

    if (!hitsWall(nx, ny)) {
      player.x = nx;
      player.y = ny;
    }
  }
}

// ===== DRAW =====
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Camera
  ctx.save();
  ctx.translate(
    canvas.width / 2 - player.x,
    canvas.height / 2 - player.y
  );

  // Maze
  for (let y = 0; y < maze.length; y++) {
    for (let x = 0; x < maze[y].length; x++) {
      if (maze[y][x] === "1") {
        ctx.fillStyle = "#333";
        ctx.fillRect(x * TILE, y * TILE, TILE, TILE);
      }
    }
  }

  // Player
  ctx.fillStyle = "white";
  ctx.beginPath();
  ctx.arc(player.x, player.y, player.radius, 0, Math.PI * 2);
  ctx.fill();

  // Facing direction
  ctx.strokeStyle = "red";
  ctx.beginPath();
  ctx.moveTo(player.x, player.y);
  ctx.lineTo(
    player.x + Math.cos(player.angle) * 25,
    player.y + Math.sin(player.angle) * 25
  );
  ctx.stroke();

  ctx.restore();
}

// ===== LOOP =====
function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
